<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>EverOn Bitcoin Ticker ‚Äì Firmware Versions</title>
  <style>
    :root {
      --primary: #0078d7;
      --primary-dark: #005ea3;
      --muted: #777;
      --bg: #fff;
      --text: #1a1a1a;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    h2 {
      font-size: 1rem;
      color: var(--muted);
      margin: 0.8rem 0 1.4rem;
    }

    table {
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 16px;
      border-bottom: 1px solid #eee;
      word-break: break-word;
    }

    th {
      background: #f3f3f3;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .status-active { color: var(--primary); font-weight: 600; }
    .status-obsolete { color: #999; }

    .download-btn {
      background: var(--primary);
      color: white;
      padding: 10px 18px;
      border-radius: 8px;
      text-decoration: none;
      font-size: 0.95rem;
      display: inline-block;
      transition: background 0.2s ease;
      white-space: nowrap;
    }
    .download-btn:hover { background: var(--primary-dark); }

    .release-date {
      font-size: 0.85rem;
      color: #666;
      display: block;
      margin-top: 2px;
    }

    .changelog {
      display: none;
      text-align: left; /* ‚úÖ Always left aligned */
      font-size: 0.85rem;
      background: #f8f8f8;
      padding: 10px 14px;
      border-radius: 8px;
      margin-top: 6px;
      line-height: 1.5;
      color: #222;
    }

    .changelog ul {
      margin: 6px 0 0 16px;
      padding: 0;
    }

    footer {
      margin-top: 40px;
      font-size: 0.8rem;
      color: var(--muted);
    }

    /* üì± Mobile layout */
    @media (max-width: 700px) {
      h1 { font-size: 1.6rem; }
      h2 { font-size: 0.95rem; }
      body { padding: 10px; }

      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      thead { display: none; }

      tr {
        background: white;
        margin-bottom: 14px;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        padding: 14px;
      }

      td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border: none;
      }

      td::before {
        content: attr(data-label);
        font-weight: 600;
        color: #555;
        flex: 1;
        text-align: left;
      }

      td strong, td span, td a {
        flex: 2;
        text-align: right;
      }

      /* ‚úÖ Fix button */
      .download-btn {
        width: 100%;
        display: block;
        text-align: center;
        margin-top: 10px;
        padding: 12px 0;
        font-size: 1rem;
      }

      /* ‚úÖ Make changelog left-aligned even on mobile */
      .changelog {
        display: none;
        font-size: 0.9rem;
        background: #f5f5f5;
        padding: 10px 14px;
        border-radius: 8px;
        margin-top: 10px;
        text-align: left;
        line-height: 1.5;
      }
    }
  </style>
</head>
<body>
  <h1>üöÄ EverOn Bitcoin Ticker</h1>
  <h2>Firmware Version Table</h2>

  <table id="firmwareTable">
    <thead>
      <tr><th>Version</th><th>Status</th><th>Download</th></tr>
    </thead>
    <tbody id="tableBody">
      <tr><td colspan="3">Loading...</td></tr>
    </tbody>
  </table>

  <p style="margin-top:16px;">
    üìÑ <a href="version.json" target="_blank">version.json</a> ‚Äì for OTA check
  </p>

  <footer>¬© 2025 EverOnTH</footer>

  <script>
    async function loadFirmwareTable() {
      try {
        const res = await fetch('version.json');
        const data = await res.json();

        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';

        data.firmwares.forEach(fw => {
          const tr = document.createElement('tr');

          const versionTd = document.createElement('td');
          versionTd.setAttribute('data-label', 'Version');
          versionTd.innerHTML = `<strong>${fw.version}</strong><span class="release-date">${fw.release_date}</span>`;

          const statusTd = document.createElement('td');
          statusTd.setAttribute('data-label', 'Status');
          statusTd.textContent = fw.status === 'active' ? 'Active' : 'Obsoleted';
          statusTd.className = fw.status === 'active' ? 'status-active' : 'status-obsolete';

          const downloadTd = document.createElement('td');
          downloadTd.setAttribute('data-label', 'Download');
          const a = document.createElement('a');
          a.href = fw.firmware_url;
          a.textContent = 'Download';
          a.className = 'download-btn';
          a.setAttribute('download', '');
          downloadTd.appendChild(a);

          tr.appendChild(versionTd);
          tr.appendChild(statusTd);
          tr.appendChild(downloadTd);
          tbody.appendChild(tr);

          // changelog section
          if (fw.changelog && fw.changelog.length > 0) {
            const logTr = document.createElement('tr');
            const logTd = document.createElement('td');
            logTd.colSpan = 3;
            const changelogDiv = document.createElement('div');
            changelogDiv.className = 'changelog';
            changelogDiv.innerHTML = `<strong>Changelog:</strong><ul>` +
              fw.changelog.map(line => `<li>${line}</li>`).join('') + `</ul>`;
            logTd.appendChild(changelogDiv);
            logTr.appendChild(logTd);
            tbody.appendChild(logTr);

            tr.addEventListener('click', () => {
              changelogDiv.style.display =
                changelogDiv.style.display === 'block' ? 'none' : 'block';
            });
          }
        });
      } catch (err) {
        console.error(err);
        document.getElementById('tableBody').innerHTML =
          '<tr><td colspan="3">‚ùå Failed to load version.json</td></tr>';
      }
    }
    loadFirmwareTable();
  </script>
</body>
</html>
